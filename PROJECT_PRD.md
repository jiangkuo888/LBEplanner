# WebGL动块编辑器项目 PRD

## 一、项目背景与目标

本项目旨在开发一个基于WebGL的可视化编辑器，能够读取`Json/Input/PlayArea_0.json`文件，根据其中的数据动态生成和编辑多边形区域（称为“动块”）。该编辑器将为后续的关卡设计、路径规划等功能提供基础的可视化支持。

## 二、核心功能

1. **数据读取与解析**
   - 读取`Json/Input/PlayArea_0.json`文件。
   - 解析文件中的动块数据，包括多边形顶点、入口、出口、旋转等信息。

2. **动块可视化**
   - 根据每个动块的`Points`字段绘制多边形。
   - 按`Index`编号区分和管理动块。
   - 显示每个动块的`Entrance`（入口）和`Exit`（出口）点。
   - 支持显示`DeltaYaw`（旋转角度），并在可视化时正确应用。

3. **交互与编辑**
   - 支持选择、拖拽、旋转动块。
   - 支持编辑多边形顶点、入口、出口位置。
   - 支持保存编辑后的数据为新的JSON文件。

4. **辅助功能**
   - 动块高亮、编号显示。
   - 视图缩放、平移。
   - 支持撤销/重做。

## 三、数据结构说明

以`PlayArea_0.json`为例，动块数据结构如下：

```json
{
  "Name": "1-1",           // 动块名称
  "Index": 0,               // 动块编号
  "Points": [               // 多边形顶点数组
    { "Point": { "X": -281.9, "Y": 399.2 } },
    ...
  ],
  "Entrance": {             // 入口点
    "Point": { "X": -179.99, "Y": 549.20 }
  },
  "Exit": {                 // 出口点
    "Point": { "X": -179.99, "Y": 564.20 }
  },
  "DeltaYaw": 0             // 旋转角度（度）
}
```

- `Points`：定义多边形的顶点，顺序连接形成闭合区域。
- `Entrance`/`Exit`：分别为入口和出口的坐标点。
- `DeltaYaw`：该动块的旋转角度，单位为度。

## 四、核心交互流程

1. **启动编辑器** → 选择/自动加载`PlayArea_0.json` → 解析并渲染所有动块。
2. **用户选择动块** → 显示高亮、编号、入口/出口。
3. **用户编辑动块**（拖拽、旋转、编辑顶点/入口/出口）。
4. **保存** → 导出为新的JSON文件。

## 五、技术选型建议

- **前端框架**：React/Vue/Svelte（三选一，推荐React）
- **渲染引擎**：Three.js（WebGL封装，适合2D/3D多边形渲染）或PixiJS（高性能2D渲染）
- **数据处理**：原生JS/TS或Lodash等工具库
- **文件操作**：File API（前端导入/导出JSON）

## 六、未来扩展方向

- 支持多文件、多关卡编辑。
- 动块属性扩展（如类型、颜色、标签等）。
- 路径规划、仿真等高级功能。
- 用户权限与协作编辑。

---

> 本PRD为WebGL动块编辑器的初步需求文档，后续可根据实际开发和用户反馈持续完善。 